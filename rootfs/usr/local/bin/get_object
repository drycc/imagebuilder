#!/usr/bin/env bash

mkdir -p ~/.config/rclone
touch ~/.config/rclone/rclone.conf
rclone config create storage s3 \
  provider=Other \
  access_key_id="${DRYCC_STORAGE_ACCESSKEY}" \
  secret_access_key="${DRYCC_STORAGE_SECRETKEY}" \
  endpoint="${DRYCC_STORAGE_ENDPOINT}" \
  force_path_style="${DRYCC_STORAGE_PATH_STYLE:-true}" --no-output

GET_PATH=/tmp/app.tgz

if ! rclone lsd storage: > /dev/null 2>&1; then
  sleep 9s
  echo "waiting for object storage to become ready..."
fi
rclone copyto storage:"${DRYCC_STORAGE_BUCKET}/${TAR_PATH}" "${GET_PATH}"
